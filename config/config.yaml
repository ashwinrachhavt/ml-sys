# HubSpot ML Framework Configuration

# Project Metadata
project:
  name: hubspot-ml-framework
  version: "1.0.0"
  description: "ML framework for prospect conversion prediction"

# Paths
paths:
  data:
    raw: "data/raw"
    processed: "data/processed"
    features: "data/features"
  models: "models"
  mlflow: "mlflow"
  logs: "logs"

# Data Loading
data:
  customers_file: "data/raw/customers.csv"
  noncustomers_file: "data/raw/noncustomers.csv"
  usage_file: "data/raw/usage_actions.csv"

  # Validation rules
  validation:
    check_missing: true
    check_duplicates: true
    check_schema: true
    max_missing_ratio: 0.3

# Feature Engineering
features:
  categorical:
    - EMPLOYEE_RANGE
    - INDUSTRY

  numerical:
    - ALEXA_RANK
    - MRR
    - ACTIONS_CRM_CONTACTS
    - ACTIONS_CRM_COMPANIES
    - ACTIONS_CRM_DEALS
    - ACTIONS_EMAIL
    - USERS_CRM_CONTACTS
    - USERS_CRM_COMPANIES
    - USERS_CRM_DEALS
    - USERS_EMAIL

  encoding:
    method: "target"
    handle_unknown: "value"

  scaling:
    method: "robust"

  imputation:
    numerical_strategy: "median"
    categorical_strategy: "mode"

  create_features:
    - total_actions
    - total_users
    - actions_per_user
    - email_engagement_rate
    - crm_usage_score
    - activity_recency
    - usage_frequency

# Model Training
training:
  test_size: 0.2
  val_size: 0.1
  random_state: 42
  stratify: true
  cv_folds: 5
  cv_strategy: "stratified"
  handle_imbalance:
    method: "smote"
    sampling_strategy: "auto"

# Model Configurations
models:
  xgboost:
    enabled: true
    params:
      n_estimators: 100
      max_depth: 6
      learning_rate: 0.1
      subsample: 0.8
      colsample_bytree: 0.8
      min_child_weight: 1
      gamma: 0
      reg_alpha: 0
      reg_lambda: 1
      scale_pos_weight: 1
      random_state: 42
      n_jobs: -1
      tree_method: "hist"
    tuning:
      enabled: true
      method: "optuna"
      n_trials: 50
      param_space:
        n_estimators: [50, 100, 200, 300]
        max_depth: [3, 5, 7, 9]
        learning_rate: [0.01, 0.05, 0.1, 0.2]
        subsample: [0.6, 0.8, 1.0]
        colsample_bytree: [0.6, 0.8, 1.0]

  catboost:
    enabled: true
    params:
      iterations: 1000
      depth: 6
      learning_rate: 0.1
      l2_leaf_reg: 3
      random_strength: 1
      bagging_temperature: 1
      border_count: 254
      random_state: 42
      verbose: false
      early_stopping_rounds: 50
    tuning:
      enabled: true
      method: "optuna"
      n_trials: 50
      param_space:
        iterations: [500, 1000, 1500]
        depth: [4, 6, 8, 10]
        learning_rate: [0.01, 0.05, 0.1]
        l2_leaf_reg: [1, 3, 5, 7]

  logistic_regression:
    enabled: true
    params:
      penalty: "l2"
      C: 1.0
      solver: "lbfgs"
      max_iter: 1000
      random_state: 42
      n_jobs: -1
      class_weight: "balanced"
    tuning:
      enabled: true
      method: "grid"
      param_space:
        C: [0.001, 0.01, 0.1, 1.0, 10.0]
        penalty: ["l1", "l2", "elasticnet"]
        solver: ["lbfgs", "saga"]

# Evaluation Metrics
evaluation:
  primary_metric: "roc_auc"
  metrics:
    - accuracy
    - precision
    - recall
    - f1
    - roc_auc
    - pr_auc
    - log_loss
  classification_threshold: 0.5
  optimize_threshold: true
  business_metrics:
    - conversion_rate
    - expected_revenue
    - cost_per_acquisition

# MLflow Configuration
mlflow:
  tracking_uri: "file:./mlflow"
  experiment_name: "hubspot_conversion_prediction"
  run_name_prefix: "run"
  artifact_location: "./mlflow/artifacts"
  autolog:
    enabled: true
    log_models: true
    log_input_examples: true
    log_model_signatures: true
  registry:
    model_name: "hubspot_conversion_model"
    stages:
      - None
      - Staging
      - Production
      - Archived

# Weights & Biases
wandb:
  enabled: true
  project: "hubspot-ml-framework"
  entity: null
  group: "experiment"
  tags:
    - conversion-prediction
    - production
  log_frequency: 10
  save_code: true

# API Configuration
api:
  title: "HubSpot ML API"
  description: "Production ML API for conversion prediction"
  version: "1.0.0"
  host: "0.0.0.0"
  port: 8000
  workers: 4
  cors:
    enabled: true
    origins:
      - "http://localhost:3000"
      - "https://yourdomain.com"
  rate_limit:
    enabled: true
    requests_per_minute: 100
  serving:
    model_stage: "Production"
    batch_size: 1000
    timeout: 30
    cache_predictions: true
    cache_ttl: 3600

# Monitoring
monitoring:
  prometheus:
    enabled: true
    port: 9090
    metrics_path: "/metrics"
  performance:
    track_latency: true
    track_throughput: true
    track_errors: true
    alert_threshold:
      latency_ms: 100
      error_rate: 0.05
  drift_detection:
    enabled: true
    method: "ks_test"
    reference_window: 30
    detection_window: 7
    threshold: 0.05
    features_to_monitor:
      - ALEXA_RANK
      - ACTIONS_CRM_CONTACTS
      - ACTIONS_EMAIL
  model_monitoring:
    track_predictions: true
    track_actuals: true
    calculate_metrics_daily: true
    alert_on_degradation: true
    degradation_threshold: 0.1
  retraining:
    schedule: "weekly"
    trigger_on_drift: true
    trigger_on_performance_drop: true
    min_new_samples: 1000

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file:
    enabled: true
    path: "logs/app.log"
    max_bytes: 10485760
    backup_count: 5
  console:
    enabled: true
    colorize: true

# Deployment
deployment:
  environment: "development"
  docker:
    image_name: "hubspot-ml-framework"
    tag: "latest"
    registry: null
  kubernetes:
    namespace: "ml-serving"
    replicas: 3
    resources:
      cpu: "1000m"
      memory: "2Gi"

# Security
security:
  api_key_enabled: false
  jwt_enabled: false
  ssl_enabled: false
  allowed_ips: []

# Reproducibility
reproducibility:
  random_seed: 42
  deterministic: true
  track_git_commit: true
  track_dependencies: true
